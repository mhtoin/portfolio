---
// Theme selector component for switching between visual themes and color modes
---

<div class="flex items-center gap-2">
  <!-- Visual Theme Selector -->
  <div class="relative">
    <select
      id="visual-theme-selector"
      class="appearance-none bg-transparent border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 terminal-theme:border-terminal-border terminal-theme:focus:ring-terminal-green terminal-theme:rounded-none terminal-theme:border-2"
      aria-label="Select visual theme"
    >
      <option value="original">Original</option>
      <option value="terminal" selected>Terminal</option>
    </select>
    <svg class="absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </div>

  <!-- Color Mode Toggle -->
  <button
    type="button"
    id="color-mode-toggle"
    class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 terminal-theme:border-2 terminal-theme:border-terminal-border terminal-theme:rounded-none terminal-theme:hover:border-terminal-green"
    aria-label="Toggle color mode"
  >
    <!-- Sun icon (visible in dark mode) -->
    <svg
      class="hidden dark:block h-5 w-5"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
      />
    </svg>
    
    <!-- Moon icon (visible in light mode) -->
    <svg
      class="block dark:hidden h-5 w-5"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
      />
    </svg>
  </button>
</div>

<script>
  import { toggleColorMode, setVisualTheme, getCurrentVisualTheme, type VisualTheme } from '@/lib/theme';
  
  function setupThemeSelector() {
    const visualThemeSelector = document.getElementById('visual-theme-selector') as HTMLSelectElement;
    const colorModeToggle = document.getElementById('color-mode-toggle');
    
    if (visualThemeSelector) {
      // Set initial value
      visualThemeSelector.value = getCurrentVisualTheme();
      
      // Handle visual theme changes
      visualThemeSelector.addEventListener('change', (e) => {
        const newTheme = (e.target as HTMLSelectElement).value as VisualTheme;
        setVisualTheme(newTheme);
      });
    }
    
    if (colorModeToggle) {
      colorModeToggle.addEventListener('click', () => {
        toggleColorMode();
      });
    }
  }
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', setupThemeSelector);
  
  // Reinitialize on view transitions
  document.addEventListener('astro:after-swap', setupThemeSelector);
</script>

<style>
  /* Custom select styling */
  #visual-theme-selector {
    background-image: none;
  }
  
  /* View transition naming for smooth theme changes */
  :root {
    view-transition-name: root;
  }
</style>